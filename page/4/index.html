<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>再读斋</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="像外行一样思考,像专家一样实践。">
<meta property="og:type" content="website">
<meta property="og:title" content="再读斋">
<meta property="og:url" content="http://liuguoquan727.github.io/page/4/index.html">
<meta property="og:site_name" content="再读斋">
<meta property="og:description" content="像外行一样思考,像专家一样实践。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="再读斋">
<meta name="twitter:description" content="像外行一样思考,像专家一样实践。">
  
    <link rel="alternate" href="/atom.xml" title="再读斋" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://liuguoquan727.github.io"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">再读斋</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">MICHAEL</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Go 标准库⑦JSON文件处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/18/Go 标准库⑦JSON文件处理/" class="article-date">
  <time datetime="2017-05-18T13:50:53.000Z" itemprop="datePublished">2017-05-18 21:50:53</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Go/">Go</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/18/Go 标准库⑦JSON文件处理/">Go 标准库⑦JSON文件处理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>GO语言标准库<code>encoding/json</code>用于处理JSON文本数据。</p>
<h1 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h1><p>将一个对象编码成JSON数据，接受一个interface{}对象，返回[]byte和error：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Marshal</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span></div></pre></td></tr></table></figure>
<p>Marshal函数将会递归遍历整个对象，依次按成员类型对这个对象进行编码，类型转换规则如下：</p>
<ul>
<li>bool类型 转换为JSON的Boolean</li>
<li>整数、浮点数等数值类型 转换为JSON的Number</li>
<li>string 转换为JSON的字符串(带””引号)</li>
<li>struct 转换为JSON的Object，再根据各个成员的类型递归打包</li>
<li>数组或切片 转换为JSON的Array</li>
<li>[]byte 会先进行base64编码然后转换为JSON字符串</li>
<li>map 转换为JSON的Object，key必须是string</li>
<li>interface{} 按照内部的实际类型进行转换</li>
<li>nil 转为JSON的null</li>
<li>channel,func等类型 会返回UnsupportedTypeError</li>
</ul>
<h1 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h1><p>将JSON数据解析为Go结构体</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unmarshal</span><span class="params">(data []<span class="keyword">byte</span>, v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span></span></div></pre></td></tr></table></figure>
<p>interface{}类型在Unmarshal时，会自动将JSON转换为对应的数据类型：</p>
<ul>
<li>JSON的boolean 转换为bool</li>
<li>JSON的数值 转换为float64</li>
<li>JSON的字符串 转换为string</li>
<li>JSON的Array 转换为[]interface{}</li>
<li>JSON的Object 转换为map[string]interface{}</li>
<li><p>JSON的null 转换为nil</p>
</li>
<li><p>结构体必须是大写字母开头的成员才会被JSON处理到，小写字母开头的成员不会有影响。</p>
</li>
<li>Unmashal时，会自动匹配对应的变量名进行赋值，大小写不敏感。</li>
<li>Unmarshal时，如果JSON中有多余的字段，会被直接抛弃掉；如果JSON缺少某个字段，则直接忽略不对结构体中变量赋值，不会报错。</li>
</ul>
<h1 id="StructTag"><a href="#StructTag" class="headerlink" title="StructTag"></a>StructTag</h1><p>如果希望手动配置结构体的成员和JSON字段的对应关系，可以在定义结构体的时候给成员打标签</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">type Message struct &#123;  </div><div class="line">    Name string `json:<span class="string">"msg_name"</span>`       <span class="comment">// 对应JSON的msg_name  </span></div><div class="line">    Body string `json:<span class="string">"body,omitempty"</span>` <span class="comment">// 如果为空置则忽略字段  </span></div><div class="line">    Time int64  `json:<span class="string">"-"</span>`              <span class="comment">// 直接忽略字段  </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="JSON文件"><a href="#JSON文件" class="headerlink" title="JSON文件"></a>JSON文件</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"servers"</span>:[</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"serverName"</span>:<span class="string">"Shanghai_VPN"</span>,</div><div class="line">      <span class="attr">"serverIp"</span>:<span class="string">"127.0.0.1"</span>,</div><div class="line">      <span class="attr">"port"</span>:<span class="number">8080</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"serverName"</span>:<span class="string">"Beijing_VPN"</span>,</div><div class="line">      <span class="attr">"serverIp"</span>:<span class="string">"127.0.0.2"</span>,</div><div class="line">      <span class="attr">"port"</span>:<span class="number">8080</span></div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="JSON序列化和反序列化"><a href="#JSON序列化和反序列化" class="headerlink" title="JSON序列化和反序列化"></a>JSON序列化和反序列化</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"os"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"encoding/json"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> &#123;</div><div class="line">	ServerName <span class="keyword">string</span> <span class="string">`json:"serverName"`</span> <span class="comment">//序列化json字段名为serverName</span></div><div class="line">	ServerIp <span class="keyword">string</span> <span class="string">`json:"serverIp"`</span></div><div class="line">	Port <span class="keyword">int</span> <span class="string">`json:"port"`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">type</span> ServerSlice <span class="keyword">struct</span> &#123;</div><div class="line">	Servers []Server <span class="string">`json:"servers"`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line"></div><div class="line">	<span class="keyword">var</span> s ServerSlice</div><div class="line">	<span class="keyword">var</span> count <span class="keyword">int</span></div><div class="line"></div><div class="line">	path := <span class="string">"/Users/liuguoquan/go/src/liu/basic/123.json"</span></div><div class="line">	fin, err := os.Open(path)</div><div class="line"></div><div class="line">	<span class="keyword">defer</span> fin.Close() <span class="comment">//延迟关闭资源</span></div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">1024</span>) <span class="comment">//创建一个初始容量为1024的slice,作为缓冲容器</span></div><div class="line">	<span class="keyword">for</span> &#123;</div><div class="line">		<span class="comment">//循环读取文件数据到缓冲容器中,返回读取到的个数</span></div><div class="line">		n, _ := fin.Read(buf)</div><div class="line">		count += n</div><div class="line">		<span class="keyword">if</span> <span class="number">0</span> == n &#123;</div><div class="line">			<span class="keyword">break</span> <span class="comment">//如果读到个数为0,则读取完毕,跳出循环</span></div><div class="line">		&#125;</div><div class="line">		<span class="comment">//从缓冲slice中写出数据,从slice下标0到n,通过os.Stdout写出到控制台</span></div><div class="line">		<span class="comment">//os.Stdout.Write(buf[:n])</span></div><div class="line">	&#125;</div><div class="line">	fmt.Println(count)</div><div class="line">	input := buf[<span class="number">0</span>:count]</div><div class="line">	<span class="comment">//json反序列化</span></div><div class="line">	err = json.Unmarshal(input, &amp;s)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(err)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(s.Servers);i++ &#123;</div><div class="line">		fmt.Println(s.Servers[i].ServerName,s.Servers[i].ServerIp,s.Servers[i].Port)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	server1 := Server &#123;ServerName:<span class="string">"liu"</span>,ServerIp:<span class="string">"192.168.1.12"</span>,Port:<span class="number">8888</span>&#125;</div><div class="line">	server2 := Server &#123;ServerName:<span class="string">"lee"</span>,ServerIp:<span class="string">"192.168.1.13"</span>,Port:<span class="number">8888</span>&#125;</div><div class="line">	s2 := ServerSlice &#123; Servers:[]Server&#123;server1,server2&#125; &#125;</div><div class="line">	<span class="comment">//json序列化</span></div><div class="line">	out,err := json.Marshal(s2)</div><div class="line"></div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	os.Stdout.Write(out)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//打印</span></div><div class="line">Shanghai_VPN <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">8080</span></div><div class="line">Beijing_VPN <span class="number">127.0</span><span class="number">.0</span><span class="number">.2</span> <span class="number">8080</span></div><div class="line">&#123;<span class="string">"servers"</span>:[&#123;<span class="string">"serverName"</span>:<span class="string">"liu"</span>,<span class="string">"serverIp"</span>:<span class="string">"192.168.1.12"</span>,<span class="string">"port"</span>:<span class="number">8888</span>&#125;,&#123;<span class="string">"serverName"</span>:<span class="string">"lee"</span>,<span class="string">"serverIp"</span>:<span class="string">"192.168.1.13"</span>,<span class="string">"port"</span>:<span class="number">8888</span>&#125;]&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuguoquan727.github.io/2017/05/18/Go 标准库⑦JSON文件处理/" data-id="cj6f2gfm3003t4h199j2sk2v4" class="article-share-link">分享</a>
      
        <a href="http://liuguoquan727.github.io/2017/05/18/Go 标准库⑦JSON文件处理/#ds-thread" class="article-comment-link">留言</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go基础/">Go基础</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-Go 标准库⑥log" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/17/Go 标准库⑥log/" class="article-date">
  <time datetime="2017-05-17T13:50:53.000Z" itemprop="datePublished">2017-05-17 21:50:53</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Go/">Go</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/17/Go 标准库⑥log/">Go 标准库介绍⑥log</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <blockquote>
<p>log 包实现了简单的日志服务，log 包定义了Logger类型，该类型提供了一些格式化输出的方法。本包也提供了一个预定义的“标准”Logger，可以通过辅助函数Print[f|ln]、Fatal[f|ln]和Panic[f|ln]访问，比手工创建一个Logger对象更容易使用。Logger会打印每条日志信息的日期、时间，默认输出到标准错误。Fatal系列函数会在写入日志信息后调用os.Exit(1)。Panic系列函数会在写入日志信息后调用panic。</p>
</blockquote>
<h1 id="Logger结构体"><a href="#Logger结构体" class="headerlink" title="Logger结构体"></a>Logger结构体</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> Logger <span class="keyword">struct</span> &#123;</div><div class="line">    mu     sync.Mutex <span class="comment">// ensures atomic writes; protects the following fields</span></div><div class="line">    prefix <span class="keyword">string</span>     <span class="comment">// prefix to write at beginning of each line</span></div><div class="line">    flag   <span class="keyword">int</span>        <span class="comment">// properties</span></div><div class="line">    out    io.Writer  <span class="comment">// destination for output</span></div><div class="line">    buf    []<span class="keyword">byte</span>     <span class="comment">// for accumulating text to write</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Logger 类型表示一个记录日志的对象，它会生成一行行的输出写入一个io.Writer 接口。每一条日志操作会调用一次io.Writer 接口的Write 方法。Logger 类型的对象可以被多个线程安全的同时使用，它会保证对io.Writer 接口的顺序访问。</p>
<ul>
<li><p>func New(out io.Writer, prefix string, flag int) *Logger // 创建一个Logger, out设置日志信息写入的目的地, prefix 添加到生成的每一条日志前面, flag定义日志的属性</p>
</li>
<li><p>func (l *Logger) Flags() int // Flags返回logger的输出选项</p>
</li>
<li><p>func (l *Logger) SetFlags(flag int) // SetFlags设置logger的输出选项</p>
</li>
<li><p>func (l *Logger) Prefix() string // Prefix返回logger的输出前缀</p>
</li>
<li><p>func (l *Logger) SetPrefix(prefix string) // SSetPrefix设置logger的输出前缀</p>
</li>
<li><p>func (l *Logger) Output(calldepth int, s string) error // 输出一条日志</p>
</li>
<li><p>func (l *Logger) Printf(format string, v …interface{}) // 将生成的格式化字符串输出到out</p>
</li>
<li><p>func (l *Logger) Fatal(v …interface{}) // Fatal等价于{l.Print(v…); os.Exit(1)}</p>
</li>
<li><p>func (l *Logger) Panic(v …interface{}) // Panic等价于{l.Print(v…); panic(…)}</p>
</li>
</ul>
<h1 id="log导出函数"><a href="#log导出函数" class="headerlink" title="log导出函数"></a>log导出函数</h1><p>log 导出函数基于预定义的 std 变量 <code>var std = New(os.Stderr, &quot;&quot;, LstdFlags)</code> 实现。</p>
<ul>
<li>func Flags() int // 获取预定义“标准”日志输出属性</li>
<li>func Prefix() string // 获取预定义“标准”日志前缀</li>
<li>func SetOutput(w io.Writer) // 设置预定义“标准”日志输出位置</li>
<li>func Print(v …interface{}) // 打印一条标准日志</li>
</ul>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// go 标准库 log</span></div><div class="line"><span class="keyword">package</span> main</div><div class="line"> </div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"log"</span></div><div class="line">    <span class="string">"os"</span></div><div class="line">)</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    logger := log.New(os.Stdout, <span class="string">"a log:"</span>, log.Lshortfile)</div><div class="line">    logger.SetFlags(log.Llongfile)</div><div class="line">    fmt.Println(logger.Flags()) <span class="comment">// 8</span></div><div class="line"> </div><div class="line">    logger.SetPrefix(<span class="string">"debug:"</span>)</div><div class="line">    fmt.Println(logger.Prefix()) <span class="comment">// de<span class="doctag">bug:</span></span></div><div class="line"> </div><div class="line">    logger.Print(<span class="string">"hello, log file"</span>)</div><div class="line"> </div><div class="line">    err := logger.Output(<span class="number">2</span>, <span class="string">"world"</span>)</div><div class="line">    fmt.Println(err)</div><div class="line"> </div><div class="line">    logger.Printf(<span class="string">"%v\t%v"</span>, <span class="string">"hello"</span>, <span class="string">"go"</span>)</div><div class="line"> </div><div class="line">    <span class="comment">// logger.Fatal("fatal log")</span></div><div class="line">    <span class="comment">// logger.Panic("Panic log")</span></div><div class="line"> </div><div class="line">    <span class="comment">// 使用预定义日志类型</span></div><div class="line">    fmt.Println(log.Flags())         <span class="comment">// 3</span></div><div class="line">    fmt.Println(log.Prefix())        <span class="comment">// ''</span></div><div class="line">    log.Print(<span class="string">"hello predefine log"</span>) <span class="comment">// 2017/03/04 16:34:27 hello predefine log</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuguoquan727.github.io/2017/05/17/Go 标准库⑥log/" data-id="cj6f2gflx003d4h19qsphay73" class="article-share-link">分享</a>
      
        <a href="http://liuguoquan727.github.io/2017/05/17/Go 标准库⑥log/#ds-thread" class="article-comment-link">留言</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go基础/">Go基础</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-Go 标准库⑤io" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/16/Go 标准库⑤io/" class="article-date">
  <time datetime="2017-05-16T13:50:53.000Z" itemprop="datePublished">2017-05-16 21:50:53</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Go/">Go</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/16/Go 标准库⑤io/">Go 标准库介绍⑤io</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="io-包的接口"><a href="#io-包的接口" class="headerlink" title="io 包的接口"></a>io 包的接口</h1><ul>
<li>Reader</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> Reader <span class="keyword">interface</span> &#123;</div><div class="line">    Read(p []<span class="keyword">byte</span>) (n <span class="keyword">int</span>, err error)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Reader 接口用于包装基本的读取方法。Read 方法读取 len(p) 字节数据写入p。它返回写入的字节数和遇到的任何错误。即使Read方法返回值 n &lt; len(p)，本方法在被调用时仍可能使用p的全部长度作为暂存空间。如果有部分可用数据，但不够len(p)字节，Read会返回可以读取到的数据，而不是等待更多数据。</p>
<ul>
<li>Writer</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</div><div class="line">    Write(p []<span class="keyword">byte</span>) (n <span class="keyword">int</span>, err error)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Writer 接口用于包装基本的写入方法。Write 方法将 len(p) 字节数据从p写入底层的数据流。它会返回写入的字节数据<code>(0 &lt;= n &lt;= len(p))</code> 和遇到的任何导致写入提取结束的错误。如果它返回的 n &lt; len(p), Write必须返回非nil的错误。</p>
<ul>
<li>Closer</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> Closer <span class="keyword">interface</span> &#123;</div><div class="line">    Close() error</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Closer 接口用于包装基本的关闭方法。</p>
<ul>
<li>Seeker</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> Seeker <span class="keyword">interface</span> &#123;</div><div class="line">    Seek(offset <span class="keyword">int64</span>, whence <span class="keyword">int</span>) (<span class="keyword">int64</span>, error)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Seeker 接口用于包装基本的移位方法。Seek方法设定下一次读写的位置：偏移量为offset，校准点由whence确定：0表示相对于文件起始；1表示相对于当前位置；2表示相对于文件结尾。Seek方法返回新的位置以及可能遇到的错误。</p>
<ul>
<li>ReaderAt</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> ReaderAt <span class="keyword">interface</span> &#123;</div><div class="line">    ReadAt(p []<span class="keyword">byte</span>, off <span class="keyword">int64</span>) (n <span class="keyword">int</span>, err error)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ReaderAt 接口包装了基本的ReadAt方法。ReadAt从底层输入流的偏移量off位置读取len(p) 字节数据写入p， 它返回读取的字节数(0 &lt;= n &lt;= len(p)) 和遇到的任何错误。</p>
<ul>
<li>ByteReader</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> ByteReader <span class="keyword">interface</span> &#123;</div><div class="line">    ReadByte() (c <span class="keyword">byte</span>, err error)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ByteReader 是基本的ReadByte方法的包装。ReadByte读取输入中的单个字节并返回。如果没有字节可读取，会返回错误。</p>
<ul>
<li>ByteScanner</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> ByteScanner <span class="keyword">interface</span> &#123;</div><div class="line">    ByteReader</div><div class="line">    UnreadByte() error</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ByteScanner 接口在基本的ReadByte 方法之外还添加了UnreadByte方法。UnreadByte方法让下一次调用ReadByte时返回之前调用ReadByte时返回的同一个字节。连续调用两次UnreadByte方法而中间没有调用ReadByte时，可能会导致错误</p>
<ul>
<li>ReaderFrom</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> ReaderFrom <span class="keyword">interface</span> &#123;</div><div class="line">    ReadFrom(r Reader) (n <span class="keyword">int64</span>, err error)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ReaderFrom 接口包装了基本的ReadFrom方法。ReadFrom 方法从r 读取数据直到EOF或者遇到错误。返回值n是读取的字节数，执行时遇到的错误（EOF除外）也会被返回</p>
<ul>
<li>LimitedReader</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> LimitedReader <span class="keyword">struct</span> &#123;</div><div class="line">    R Reader <span class="comment">// underlying reader</span></div><div class="line">    N <span class="keyword">int64</span>  <span class="comment">// max bytes remaining</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>LimitedReader 从R中读取数据，但限制可以读取的数据的量为最多N 字节，每次调用Read方法都会更新N 以标记剩余可以读取的字节数。</p>
<ul>
<li>func LimitReader(r Reader, n int64) LimitedReader // 创建一个 LimitedReader</li>
<li><p>func (l *LimitedReader) Read(p []byte) (n int, err error)</p>
</li>
<li><p>SectionReader</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> SectionReader <span class="keyword">struct</span> &#123;</div><div class="line">    r     ReaderAt</div><div class="line">    base  <span class="keyword">int64</span></div><div class="line">    off   <span class="keyword">int64</span></div><div class="line">    limit <span class="keyword">int64</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>SectionReader 实现了对底层满足ReadAt 接口的输入流某个片段的Read、ReadAt、Seek方法。</p>
<ul>
<li>func NewSectionReader(r ReaderAt, off int64, n int64) *SectionReader // 返回一个从r中的偏移量off处为起始，读取n个字节后以停止的SectionReader</li>
<li>func (s *SectionReader) Size() int64 // Size返回该片段的字节数</li>
</ul>
<h1 id="io-导出函数"><a href="#io-导出函数" class="headerlink" title="io 导出函数"></a>io 导出函数</h1><ul>
<li>func WriteString(w Writer, s string) (n int, err error) // 将字符串s的内容写入w中</li>
<li>func Copy(dst Writer, src Reader) (written int64, err error) // 将src的数据拷贝到dst，直到在src上到达EOF或发生错误。返回拷贝的字节数和遇到的第一个错误</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"> </div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"io"</span></div><div class="line">    <span class="string">"log"</span></div><div class="line">    <span class="string">"os"</span></div><div class="line">    <span class="string">"strings"</span></div><div class="line">)</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    r := strings.NewReader(<span class="string">"go is a programming language\n"</span>)</div><div class="line">    <span class="keyword">if</span> n, err := io.Copy(os.Stdout, r); err != <span class="literal">nil</span> &#123;</div><div class="line">        log.Fatal(n, err)</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="comment">// writestring</span></div><div class="line">    io.WriteString(os.Stdout, <span class="string">"hello go\n"</span>)</div><div class="line"> </div><div class="line">    <span class="comment">// 从标准输入copy 到标准输出</span></div><div class="line">    <span class="keyword">if</span> n, err := io.Copy(os.Stdout, os.Stdin); err != <span class="literal">nil</span> &#123;</div><div class="line">        fmt.Println(n, err)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuguoquan727.github.io/2017/05/16/Go 标准库⑤io/" data-id="cj6f2gfm0003o4h19y31i2ra0" class="article-share-link">分享</a>
      
        <a href="http://liuguoquan727.github.io/2017/05/16/Go 标准库⑤io/#ds-thread" class="article-comment-link">留言</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go基础/">Go基础</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-Go 标准库④path" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/15/Go 标准库④path/" class="article-date">
  <time datetime="2017-05-15T13:50:53.000Z" itemprop="datePublished">2017-05-15 21:50:53</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Go/">Go</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/15/Go 标准库④path/">Go 标准库介绍④path</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="path-包"><a href="#path-包" class="headerlink" title="path 包"></a>path 包</h1><p>path实现了对斜杠分隔的路径进行操作的函数。</p>
<ul>
<li>func IsAbs(path string) bool // 判断是否是一个绝对路径</li>
<li>func Split(path string) (dir, file string) // 将路径分割为路径和文件名</li>
<li>func Join(elem …string) string // 将多个字符串合并为一个路径</li>
<li>func Ext(path string) string // 返回路径中扩展部分</li>
<li>func Base(path string) string // 返回路径的最后一个元素</li>
<li>func Dir(path string) string // 返回路径中目录部分</li>
<li>func Clean(path string) string // 返回同目录的最短路径</li>
<li>func Match(pattern, name string) (matched bool, err error) // 正则是否匹配路径（shell 文件名匹配）</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// go 标准库 path</span></div><div class="line"><span class="keyword">package</span> main</div><div class="line"> </div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"path"</span></div><div class="line">)</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    pt := <span class="string">"~/gocode/src/go_note/package/path"</span></div><div class="line"> </div><div class="line">    <span class="comment">// 判断是否是一个绝对路径</span></div><div class="line">    is_abs := path.IsAbs(pt)</div><div class="line">    fmt.Println(is_abs) <span class="comment">// false</span></div><div class="line"> </div><div class="line">    <span class="comment">// 将路径分割为路径和文件名</span></div><div class="line">    pf := <span class="string">"~gocode/src/go_note/package/path/path.go"</span></div><div class="line">    dir, file := path.Split(pf)</div><div class="line">    fmt.Println(dir, file) <span class="comment">// ~gocode/src/go_note/package/path/ path.go</span></div><div class="line"> </div><div class="line">    <span class="comment">// 将多个字符串合并为一个路径</span></div><div class="line">    dir_join := path.Join(<span class="string">"usr"</span>, <span class="string">"local"</span>, <span class="string">"bin"</span>)</div><div class="line">    fmt.Println(dir_join) <span class="comment">// usr/local/bin</span></div><div class="line"> </div><div class="line">    <span class="comment">// 返回路径中扩展</span></div><div class="line">    file_ext := path.Ext(pf)</div><div class="line">    fmt.Println(file_ext) <span class="comment">// .go</span></div><div class="line"> </div><div class="line">    <span class="comment">// 返回路径的最后一个元素</span></div><div class="line">    dir_base := path.Base(pf)</div><div class="line">    fmt.Println(dir_base) <span class="comment">// path.go</span></div><div class="line"> </div><div class="line">    <span class="comment">// 返回路径中目录部分</span></div><div class="line">    dir = path.Dir(pf)</div><div class="line">    fmt.Println(dir) <span class="comment">// ~gocode/src/go_note/package/path</span></div><div class="line"> </div><div class="line">    <span class="comment">// 返回同目录的最短路径</span></div><div class="line">    dir_a := <span class="string">"/usr/../etc/../etc/ssh"</span></div><div class="line">    fmt.Println(path.Clean(dir_a)) <span class="comment">// /etc/ssh</span></div><div class="line"> </div><div class="line">    <span class="comment">// 正则是否匹配路径</span></div><div class="line">    is_match, err := path.Match(<span class="string">"*.xml"</span>, <span class="string">"a.xml"</span>)</div><div class="line">    fmt.Println(is_match, err) <span class="comment">// true &amp;lt;nil&amp;gt;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="path-filepath-包"><a href="#path-filepath-包" class="headerlink" title="path/filepath 包"></a>path/filepath 包</h1><p>filepath 包实现了兼容各操作系统的文件路径操作函数。</p>
<ul>
<li>filepath.Separator // 预定义变量，表示路径分隔符 /</li>
<li>filepath.ListSeparator // 预定义变量，表示环境变量分隔符 :</li>
<li>func Abs(path string) (string, error) // 返回path 相对当前路径的绝对路径</li>
<li>func Clean(path string) string // 返回path 的最短路径</li>
<li>func Rel(basepath, targpath string) (string, error) // 返回targpath 相对 basepath路径</li>
<li>func EvalSymlinks(path string) (string, error) // 返回软链指向的路径</li>
<li>func VolumeName(path string) string // 返回路径最前面的卷名</li>
<li>func ToSlash(path string) string // 路径分隔符替换为 /</li>
<li>func FromSlash(path string) string // / 替换为路径分隔符</li>
<li>func SplitList(path string) []string // 分隔环境变量里面的路径</li>
<li>func Walk(root string, walkFn WalkFunc) error // 遍历 root 目录下的文件树，并调用 walkFn</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// go 标准库 path/filepath</span></div><div class="line"><span class="keyword">package</span> main</div><div class="line"> </div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"os"</span></div><div class="line">    <span class="string">"path/filepath"</span></div><div class="line">)</div><div class="line"> </div><div class="line"><span class="comment">// 打印路径名称</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">pathName</span><span class="params">(path <span class="keyword">string</span>, info os.FileInfo, err error)</span> <span class="title">error</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">        <span class="keyword">return</span> err</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        fmt.Println(path)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 预定义变量</span></div><div class="line">    fmt.Println(<span class="keyword">string</span>(filepath.Separator), <span class="keyword">string</span>(filepath.ListSeparator))</div><div class="line"> </div><div class="line">    <span class="comment">// 返回path 相对当前路径的绝对路径</span></div><div class="line">    dir := <span class="string">"~/gocode/src/go_note/package/filepath"</span></div><div class="line">    real_dir, err := filepath.Abs(dir)</div><div class="line">    fmt.Println(real_dir, err)</div><div class="line"> </div><div class="line">    <span class="comment">// 返回path 的最短路径</span></div><div class="line">    dir = <span class="string">"/usr/../etc/../tmp"</span></div><div class="line">    clear_dir := filepath.Clean(dir)</div><div class="line">    fmt.Println(clear_dir) <span class="comment">// /tmp</span></div><div class="line"> </div><div class="line">    <span class="comment">// 返回targpath 相对 basepath路径</span></div><div class="line">    basepath, targpath := <span class="string">"/usr/local"</span>, <span class="string">"/usr/local/go/bin"</span></div><div class="line">    rel_dir, err := filepath.Rel(basepath, targpath)</div><div class="line">    fmt.Println(rel_dir, err) <span class="comment">// go/bin &amp;lt;nil&amp;gt;</span></div><div class="line"> </div><div class="line">    <span class="comment">// 返回软链指向的路径</span></div><div class="line">    symlink := <span class="string">"/usr/local"</span></div><div class="line">    real_dir, err = filepath.EvalSymlinks(symlink)</div><div class="line">    fmt.Println(real_dir, err) <span class="comment">// /usr/local &amp;lt;nil&amp;gt;</span></div><div class="line"> </div><div class="line">    <span class="comment">// 返回路径最前面的卷名</span></div><div class="line">    root := <span class="string">"/usr/local/go"</span></div><div class="line">    vol := filepath.VolumeName(root)</div><div class="line">    fmt.Println(vol) <span class="comment">// ''</span></div><div class="line"> </div><div class="line">    <span class="comment">// 路径分隔符替换为 `/`</span></div><div class="line">    slash_dir := filepath.ToSlash(root)</div><div class="line">    fmt.Println(slash_dir) <span class="comment">// /usr/local/go</span></div><div class="line"> </div><div class="line">    <span class="comment">//  `/` 替换为路径分隔符</span></div><div class="line">    from_slash := filepath.FromSlash(slash_dir)</div><div class="line">    fmt.Println(from_slash) <span class="comment">// /usr/local/go</span></div><div class="line"> </div><div class="line">    <span class="comment">// 分隔环境变量里面的路径</span></div><div class="line">    env_path := <span class="string">"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/X11/bin:/usr/local/go/bin"</span></div><div class="line">    env_slice := filepath.SplitList(env_path)</div><div class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> env_slice &#123;</div><div class="line">        fmt.Println(k, v)</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 0 /usr/local/bin</span></div><div class="line">    <span class="comment">// 1 /usr/bin</span></div><div class="line">    <span class="comment">// 2 /bin</span></div><div class="line">    <span class="comment">// 3 /usr/sbin</span></div><div class="line">    <span class="comment">// 4 /sbin</span></div><div class="line">    <span class="comment">// 5 /opt/X11/bin</span></div><div class="line">    <span class="comment">// 6 /usr/local/go/bin</span></div><div class="line"> </div><div class="line">    <span class="comment">// 遍历 root 目录下的文件树，并调用 walkFn</span></div><div class="line">    root_dir, err := os.Getwd()</div><div class="line">    err = filepath.Walk(root_dir, pathName)</div><div class="line">    fmt.Println(err)</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuguoquan727.github.io/2017/05/15/Go 标准库④path/" data-id="cj6f2gflx003g4h191d3ppveq" class="article-share-link">分享</a>
      
        <a href="http://liuguoquan727.github.io/2017/05/15/Go 标准库④path/#ds-thread" class="article-comment-link">留言</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go基础/">Go基础</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-Go 标准库③os" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/14/Go 标准库③os/" class="article-date">
  <time datetime="2017-05-14T13:50:53.000Z" itemprop="datePublished">2017-05-14 21:50:53</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Go/">Go</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/14/Go 标准库③os/">Go 标准库介绍③os</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>os 包提供了不依赖平台的操作系统函数接口。错误处理设计为go 风格，失败的调用会返回错误值而非错误码。通常错误值里包含更多信息。</p>
<h1 id="os-常用导出函数"><a href="#os-常用导出函数" class="headerlink" title="os 常用导出函数"></a>os 常用导出函数</h1><ul>
<li>func Hostname() (name string, err error) // Hostname返回内核提供的主机名</li>
<li>func Environ() []string // Environ返回表示环境变量的格式为”key=value”的字符串的切片拷贝</li>
<li>func Getenv(key string) string // Getenv检索并返回名为key的环境变量的值</li>
<li>func Getpid() int // Getpid返回调用者所在进程的进程ID</li>
<li>func Exit(code int) // Exit让当前程序以给出的状态码code退出。一般来说，状态码0表示成功，非0表示出错。程序会立刻终止，defer的函数不会被执行</li>
<li>func Stat(name string) (fi FileInfo, err error) // 获取文件信息</li>
<li>func Getwd() (dir string, err error) // Getwd返回一个对应当前工作目录的根路径</li>
<li>func Mkdir(name string, perm FileMode) error // 使用指定的权限和名称创建一个目录</li>
<li>func MkdirAll(path string, perm FileMode) error // 使用指定的权限和名称创建一个目录，包括任何必要的上级目录，并返回nil，否则返回错误</li>
<li>func Remove(name string) error // 删除name指定的文件或目录</li>
<li>func TempDir() string // 返回一个用于保管临时文件的默认目录</li>
<li>var Args []string Args保管了命令行参数，第一个是程序名。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// go 标准库 os</span></div><div class="line"><span class="keyword">package</span> main</div><div class="line"> </div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"os"</span></div><div class="line">)</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 预定义变量, 保存命令行参数</span></div><div class="line">    fmt.Println(os.Args)</div><div class="line"> </div><div class="line">    <span class="comment">// 获取host name</span></div><div class="line">    fmt.Println(os.Hostname())</div><div class="line">    fmt.Println(os.Getpid())</div><div class="line"> </div><div class="line">    <span class="comment">// 获取全部环境变量</span></div><div class="line">    env := os.Environ()</div><div class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> env &#123;</div><div class="line">        fmt.Println(k, v)</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="comment">// 终止程序</span></div><div class="line">    <span class="comment">// os.Exit(1)</span></div><div class="line"> </div><div class="line">    <span class="comment">// 获取一条环境变量</span></div><div class="line">    fmt.Println(os.Getenv(<span class="string">"PATH"</span>))</div><div class="line"> </div><div class="line">    <span class="comment">// 获取当前目录</span></div><div class="line">    dir, err := os.Getwd()</div><div class="line">    fmt.Println(dir, err)</div><div class="line"> </div><div class="line">    <span class="comment">// 创建目录</span></div><div class="line">    err = os.Mkdir(dir+<span class="string">"/new_file"</span>, <span class="number">0755</span>)</div><div class="line">    fmt.Println(err)</div><div class="line"> </div><div class="line">    <span class="comment">// 创建目录</span></div><div class="line">    err = os.MkdirAll(dir+<span class="string">"/new"</span>, <span class="number">0755</span>)</div><div class="line">    fmt.Println(err)</div><div class="line"> </div><div class="line">    <span class="comment">// 删除目录</span></div><div class="line">    err = os.Remove(dir + <span class="string">"/new_file"</span>)</div><div class="line">    err = os.Remove(dir + <span class="string">"/new"</span>)</div><div class="line">    fmt.Println(err)</div><div class="line"> </div><div class="line">    <span class="comment">// 创建临时目录</span></div><div class="line">    tmp_dir := os.TempDir()</div><div class="line">    fmt.Println(tmp_dir)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="File-结构体"><a href="#File-结构体" class="headerlink" title="File 结构体"></a>File 结构体</h1><ul>
<li>func Create(name string) (file *File, err error) // Create采用模式0666（任何人都可读写，不可执行）创建一个名为name的文件，如果文件已存在会截断它（为空文件）</li>
<li>func Open(name string) (file *File, err error) // Open打开一个文件用于读取。如果操作成功，返回的文件对象的方法可用于读取数据；对应的文件描述符具有O_RDONLY模式</li>
<li>func (f *File) Stat() (fi FileInfo, err error) // Stat返回描述文件f的FileInfo类型值</li>
<li>func (f *File) Readdir(n int) (fi []FileInfo, err error) // Readdir读取目录f的内容，返回一个有n个成员的[]FileInfo，这些FileInfo是被Lstat返回的，采用目录顺序</li>
<li>func (f *File) Read(b []byte) (n int, err error) // Read方法从f中读取最多len(b)字节数据并写入b</li>
<li>func (f *File) WriteString(s string) (ret int, err error) // 向文件中写入字符串</li>
<li>func (f *File) Sync() (err error) // Sync递交文件的当前内容进行稳定的存储。一般来说，这表示将文件系统的最近写入的数据在内存中的拷贝刷新到硬盘中稳定保存</li>
<li>func (f *File) Close() error // Close关闭文件f，使文件不能用于读写</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// go 标准库 os.File</span></div><div class="line"><span class="keyword">package</span> main</div><div class="line"> </div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"os"</span></div><div class="line">    <span class="string">"time"</span></div><div class="line">)</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 获取当前目录</span></div><div class="line">    dir, err := os.Getwd()</div><div class="line">    fmt.Println(dir, err)</div><div class="line"> </div><div class="line">    file := dir + <span class="string">"/new"</span></div><div class="line">    <span class="keyword">var</span> fh *os.File</div><div class="line"> </div><div class="line">    fi, _ := os.Stat(file)</div><div class="line">    <span class="keyword">if</span> fi == <span class="literal">nil</span> &#123;</div><div class="line">        fh, _ = os.Create(file) <span class="comment">// 文件不存在就创建</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        fh, _ = os.OpenFile(file, os.O_RDWR, <span class="number">0666</span>) <span class="comment">// 文件存在就打开</span></div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    w := []<span class="keyword">byte</span>(<span class="string">"hello go language"</span> + time.Now().String())</div><div class="line">    n, err := fh.Write(w)</div><div class="line">    fmt.Println(n, err)</div><div class="line"> </div><div class="line">    <span class="comment">// 设置下次读写位置</span></div><div class="line">    ret, err := fh.Seek(<span class="number">0</span>, <span class="number">0</span>)</div><div class="line">    fmt.Println(<span class="string">"当前文件指针位置"</span>, ret, err)</div><div class="line"> </div><div class="line">    b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">128</span>)</div><div class="line">    n, err = fh.Read(b)</div><div class="line">    fmt.Println(n, err, <span class="keyword">string</span>(b))</div><div class="line"> </div><div class="line">    fh.Close()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="FileInfo-结构体"><a href="#FileInfo-结构体" class="headerlink" title="FileInfo 结构体"></a>FileInfo 结构体</h1><p>FileInfo用来描述一个文件对象</p>
<p>结构体定义:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> FileInfo <span class="keyword">interface</span> &#123;</div><div class="line">    Name() <span class="keyword">string</span>       <span class="comment">// base name of the file</span></div><div class="line">    Size() <span class="keyword">int64</span>        <span class="comment">// length in bytes for regular files; system-dependent for others</span></div><div class="line">    Mode() FileMode     <span class="comment">// file mode bits</span></div><div class="line">    ModTime() time.Time <span class="comment">// modification time</span></div><div class="line">    IsDir() <span class="keyword">bool</span>        <span class="comment">// abbreviation for Mode().IsDir()</span></div><div class="line">    Sys() <span class="keyword">interface</span>&#123;&#125;   <span class="comment">// underlying data source (can return nil)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>func Stat(name string) (fi FileInfo, err error) // Stat 返回描述文件的FileInfo。如果指定的文件对象是一个符号链接，返回的FileInfo描述该符号链接指向的文件的信息，本函数会尝试跳转该链接</li>
<li>func Lstat(name string) (fi FileInfo, err error) // Lstat 返回描述文件对象的FileInfo。如果指定的文件对象是一个符号链接，返回的FileInfo描述该符号链接的信息，本函数不会试图跳转该链接。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fi, _ := os.Stat(file)</div><div class="line"><span class="keyword">if</span> fi == <span class="literal">nil</span> &#123;</div><div class="line">    fh, _ = os.Create(file) <span class="comment">// 文件不存在就创建</span></div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    fh, _ = os.OpenFile(file, os.O_RDWR, <span class="number">0666</span>) <span class="comment">// 文件存在就打开</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuguoquan727.github.io/2017/05/14/Go 标准库③os/" data-id="cj6f2gflw003a4h19sdudv4cd" class="article-share-link">分享</a>
      
        <a href="http://liuguoquan727.github.io/2017/05/14/Go 标准库③os/#ds-thread" class="article-comment-link">留言</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go基础/">Go基础</a></li></ul>

    </footer>
  </div>
  
</article>
 


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; 上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/5/">下一页&raquo;</a>
  </nav>
</section>
           
    <aside id="sidebar">
  
    

  
    
  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title recent-posts">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/16/Android启动流程①init进程分析/">Android启动流程①init进程分析</a>
          </li>
        
          <li>
            <a href="/2017/08/15/Android系统架构与源码目录/">Android系统架构与源码目录</a>
          </li>
        
          <li>
            <a href="/2017/08/14/Mac编译Android源码/">Mac编译Android源码</a>
          </li>
        
          <li>
            <a href="/2017/06/21/JavaScript⑦对象/">JavaScript⑦对象</a>
          </li>
        
          <li>
            <a href="/2017/06/19/JavaScript⑥引用类型RegExp/">JavaScript⑥引用类型RegExp</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    
  
    <!--微信公众号二维码-->


  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2017 刘涤生&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;michaelliu0727@gmail.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/categories" class="mobile-nav-link">分类</a>
  
    <a href="/tags" class="mobile-nav-link">标签</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>